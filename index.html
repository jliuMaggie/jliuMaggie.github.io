<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金融新闻集成网站</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a56db',
                        secondary: '#1e429f',
                        neutral: '#64748b',
                        'neutral-light': '#f1f5f9',
                        'neutral-dark': '#334155',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        info: '#3b82f6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-md hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors duration-300;
            }
            .btn-outline {
                @apply border border-primary text-primary hover:bg-primary hover:text-white font-medium py-2 px-4 rounded transition-colors duration-300;
            }
            .badge {
                @apply text-xs font-medium px-2 py-1 rounded-full;
            }
            .position-badge {
                @apply text-xs px-2 py-0.5 rounded-full;
            }
            .loading {
                @apply animate-pulse bg-gray-200 rounded;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <i class="fa fa-line-chart text-primary text-2xl"></i>
            <h1 class="text-xl font-bold text-primary">金融新闻集成</h1>
        </div>
        <nav class="hidden md:flex space-x-6">
            <a href="#" class="text-primary font-medium">首页</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">市场动态</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">投资大佬</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">AI分析</a>
        </nav>
        <div class="flex items-center space-x-4">
            <button class="btn-outline hidden md:block">登录</button>
            <button class="btn-primary">注册</button>
            <button class="md:hidden text-gray-600">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 py-6">
    <section class="bg-gradient-to-r from-primary to-secondary text-white rounded-lg p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0 md:w-1/2">
                <h2 class="text-2xl font-bold mb-3">AI驱动的金融新闻与投资洞察</h2>
                <p class="text-white/80 mb-4">实时追踪全球金融动态，聚合顶尖投资大佬观点，AI智能分析市场趋势</p>
                <div class="flex space-x-4">
                    <button class="bg-white text-primary hover:bg-gray-100 font-medium py-2 px-4 rounded transition-colors duration-300">了解更多</button>
                    <button class="border border-white text-white hover:bg-white/10 font-medium py-2 px-4 rounded transition-colors duration-300">开始使用</button>
                </div>
            </div>
            <div class="md:w-1/3 h-40">
                <canvas id="marketOverviewChart"></canvas>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex flex-wrap gap-4">
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">AI工具</label>
                    <select id="ai-tool-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="doubao">豆包</option>
                        <option value="qianwen">千问</option>
                        <option value="yuanbao">元宝</option>
                        <option value="gemini">Gemini</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">投资风格</label>
                    <select id="investment-style-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="value">价值投资</option>
                        <option value="growth">成长投资</option>
                        <option value="tech">科技投资</option>
                        <option value="macro">宏观策略</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">时间</label>
                    <select id="time-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="today">今日</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">行业</label>
                    <select id="industry-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="tech">科技</option>
                        <option value="finance">金融</option>
                        <option value="healthcare">医疗健康</option>
                        <option value="consumer">消费品</option>
                        <option value="energy">能源</option>
                    </select>
                </div>
                <div class="w-full md:w-auto md:ml-auto flex items-end">
                    <button id="refresh-btn" class="btn-outline mr-2">
                        <i class="fa fa-refresh mr-1"></i>手动刷新
                    </button>
                    <button id="search-btn" class="btn-primary w-full md:w-auto">
                        <i class="fa fa-search mr-2"></i>搜索
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">AI财经事件聚合</h2>
            <div class="flex space-x-2">
                <button id="news-refresh-btn" class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-refresh mr-1"></i>刷新
                </button>
                <button class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-sort mr-1"></i>排序
                </button>
            </div>
        </div>
        <!-- 添加加载状态提示 -->
        <div id="news-loading" class="py-8 text-center hidden">
            <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
            <p class="text-gray-600">正在从豆包获取最新财经资讯...</p>
        </div>
        <div class="grid grid-cols-1 gap-4" id="ai-news-container"></div>
    </section>

    <section class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">投资大佬追踪</h2>
            <div class="flex space-x-2">
                <button id="investor-refresh-btn" class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-refresh mr-1"></i>刷新
                </button>
                <button class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-filter mr-1"></i>筛选
                </button>
            </div>
        </div>
        <!-- 添加加载状态提示 -->
        <div id="investor-loading" class="py-8 text-center hidden">
            <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
            <p class="text-gray-600">正在从豆包获取最新大佬持仓数据...</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4" id="investor-container">
            <!-- 投资大佬卡片会通过JS动态渲染 -->
        </div>
    </section>
</main>

<footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-lg font-bold mb-4">关于我们</h3>
                <p class="text-gray-400">金融新闻集成网站致力于为投资者提供全面、及时、专业的金融市场资讯和投资洞察。</p>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">快速链接</h3>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">首页</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">市场动态</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">投资大佬</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">联系我们</h3>
                <ul class="space-y-2 text-gray-400">
                    <li><i class="fa fa-envelope mr-2"></i>contact@financialnews.com</li>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">关注我们</h3>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-weixin text-2xl"></i></a>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
            <p>&copy; 2025 金融新闻集成网站. 保留所有权利.</p>
            <p class="text-xs mt-2">数据每日从豆包AI自动更新，最后更新时间：<span id="last-update-time">2025-02-20</span></p>
        </div>
    </div>
</footer>

<script>
    // 全局数据存储
    let financialEvents = [];
    let investors = {};
    
    // 配置项
    const config = {
        // 豆包API接口地址（需要替换为实际的API地址）
        doubaoApiUrl: 'https://api.doubao.com/v1/finance',
        // 每日刷新时间（凌晨3点）
        refreshTime: '03:00',
        // 手动刷新防抖时间
        debounceTime: 1000
    };

    // ====================== 核心API交互函数 ======================
    /**
     * 从豆包API获取最新财经事件数据
     */
    async function fetchFinancialEventsFromDoubao() {
        try {
            // 显示加载状态
            document.getElementById('news-loading').classList.remove('hidden');
            
            // 这里是模拟请求，实际使用时替换为真实的API调用
            // 真实场景下应该使用 fetch 或 axios 调用豆包API
            console.log('正在从豆包获取财经事件数据...');
            
            // 模拟API响应延迟
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // 模拟从豆包获取的最新数据（实际应从API返回数据）
            const freshData = [
                {
                    id: Date.now() + 1,
                    title: '美联储宣布降息25个基点',
                    summary: '美联储在最新的货币政策会议上宣布降息25个基点，这是自2019年以来的首次降息。',
                    source: '华尔街日报',
                    publishTime: new Date().toISOString(),
                    aiTools: ['doubao', 'qianwen', 'yuanbao', 'gemini'],
                    importance: {doubao:5,qianwen:4,yuanbao:5,gemini:4},
                    relatedInvestors: ['warren_buffett','ray_dalio'],
                    relatedQuotes: {
                        warren_buffett: '降息对股市是利好，但应关注企业基本面。',
                        ray_dalio: '全球央行政策转向宽松，应调整资产配置。'
                    },
                    industry: 'finance',
                    sentiment: 'positive',
                    detailUrl: 'https://www.wsj.com/finance/fed-rate-cut-2025'
                },
                {
                    id: Date.now() + 2,
                    title: '特斯拉发布全新自动驾驶芯片',
                    summary: '特斯拉CEO埃隆·马斯克展示新一代自动驾驶芯片，性能提升300%。',
                    source: '彭博社',
                    publishTime: new Date().toISOString(),
                    aiTools: ['doubao','qianwen','gemini'],
                    importance: {doubao:5,qianwen:5,gemini:5},
                    relatedInvestors: ['cathie_wood','peter_thiel'],
                    relatedQuotes: {
                        cathie_wood: '彻底改变自动驾驶行业格局。',
                        peter_thiel: '技术创新是长期价值的关键。'
                    },
                    industry: 'tech',
                    sentiment: 'positive',
                    detailUrl: 'https://www.bloomberg.com/technology/tesla-new-chip'
                }
            ];
            
            financialEvents = freshData;
            return freshData;
            
        } catch (error) {
            console.error('获取财经事件数据失败:', error);
            // 使用本地备份数据
            return getBackupFinancialEvents();
        } finally {
            // 隐藏加载状态
            document.getElementById('news-loading').classList.add('hidden');
            // 更新最后刷新时间
            updateLastUpdateTime();
        }
    }

    /**
     * 从豆包API获取最新投资大佬数据
     */
    async function fetchInvestorsFromDoubao() {
        try {
            // 显示加载状态
            document.getElementById('investor-loading').classList.remove('hidden');
            
            console.log('正在从豆包获取投资大佬数据...');
            
            // 模拟API响应延迟
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // 模拟从豆包获取的最新数据
            const freshInvestors = {
                warren_buffett: {
                    name:"沃伦·巴菲特",
                    title:"伯克希尔·哈撒韦CEO",
                    bio:"价值投资大师",
                    investmentStyle:"价值投资",
                    positions: [
                        {stock: "苹果 (AAPL)", change: "增持 5.2%", type: "increase"},
                        {stock: "美国银行 (BAC)", change: "减持 3.8%", type: "decrease"},
                        {stock: "可口可乐 (KO)", change: "持仓不变", type: "unchanged"},
                        {stock: "雪佛龙 (CVX)", change: "增持 8.5%", type: "increase"}
                    ]
                },
                george_soros: {
                    name:"乔治·索罗斯",
                    title:"索罗斯基金创始人",
                    bio:"宏观对冲大师",
                    investmentStyle:"宏观策略",
                    positions: [
                        {stock: "美元指数", change: "做多 12%", type: "increase"},
                        {stock: "欧元/英镑", change: "做空 8%", type: "decrease"},
                        {stock: "黄金 (GLD)", change: "增持 15%", type: "increase"}
                    ]
                }
            };
            
            investors = freshInvestors;
            return freshInvestors;
            
        } catch (error) {
            console.error('获取投资大佬数据失败:', error);
            // 使用本地备份数据
            return getBackupInvestors();
        } finally {
            // 隐藏加载状态
            document.getElementById('investor-loading').classList.add('hidden');
            // 更新最后刷新时间
            updateLastUpdateTime();
        }
    }

    // ====================== 渲染函数 ======================
    /**
     * 渲染财经事件卡片
     */
    function renderFinancialEvents(events) {
        const container = document.getElementById('ai-news-container');
        container.innerHTML = '';
        
        if (events.length === 0) {
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center">
                    <i class="fa fa-info-circle text-primary text-2xl mb-2"></i>
                    <p class="text-gray-600">暂无财经事件数据</p>
                </div>
            `;
            return;
        }
        
        events.forEach(event => {
            const avgImportance = Object.values(event.importance).reduce((a,b)=>a+b,0)/Object.values(event.importance).length;
            const stars = '★'.repeat(Math.round(avgImportance)) + '☆'.repeat(5-Math.round(avgImportance));
            let sentimentColor = event.sentiment==='positive'?'text-green-600':event.sentiment==='negative'?'text-red-600':'text-gray-600';
            const date = new Date(event.publishTime).toLocaleDateString();
            
            container.innerHTML += `
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-lg mb-2">${event.title}</h3>
                        <div class="flex flex-col items-end">
                            <span class="text-xs font-medium ${sentimentColor}">${event.sentiment=='positive'?'看涨':event.sentiment=='negative'?'看跌':'中性'}</span>
                            <div class="text-yellow-500 text-sm mt-1">${stars}</div>
                        </div>
                    </div>
                    <p class="text-gray-600 mb-3">${event.summary}</p>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <span class="badge bg-blue-100 text-blue-800">${event.source}</span>
                        <span class="badge bg-yellow-100 text-yellow-800">${date}</span>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-2 flex justify-between items-center">
                    <a href="${event.detailUrl}" target="_blank" class="text-primary hover:text-secondary text-sm font-medium">
                        查看原文 <i class="fa fa-external-link ml-1"></i>
                    </a>
                </div>
            </div>`;
        });
    }

    /**
     * 渲染投资大佬卡片
     */
    function renderInvestors(investorData) {
        const container = document.getElementById('investor-container');
        container.innerHTML = '';
        
        if (Object.keys(investorData).length === 0) {
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center col-span-full">
                    <i class="fa fa-info-circle text-primary text-2xl mb-2"></i>
                    <p class="text-gray-600">暂无投资大佬数据</p>
                </div>
            `;
            return;
        }
        
        // 投资大佬头像映射（实际项目中可从API获取）
        const avatarMap = {
            warren_buffett: 'https://p3-doubao-search-sign.byteimg.com/labis/8c8e8a9b332072e814423f9844f8d4a2~tplv-be4g95zd3a-image.jpeg',
            george_soros: 'https://p11-doubao-search-sign.byteimg.com/labis/ca4f671e19eed832f310cfa34ac0a6b0',
            ray_dalio: 'https://p3-doubao-search-sign.byteimg.com/labis/8c8e8a9b332072e814423f9844f8d4a2',
            carl_icahn: 'https://p11-doubao-search-sign.byteimg.com/labis/a38d77fa0c93b13eed1ce7508aed5865',
            peter_thiel: 'https://p3-doubao-search-sign.byteimg.com/labis/05fd709beb31b0d704443b0edffb5402'
        };
        
        // 投资风格标签颜色映射
        const styleColorMap = {
            '价值投资': 'bg-blue-100 text-primary',
            '宏观策略': 'bg-yellow-100 text-yellow-800',
            '全天候策略': 'bg-green-100 text-green-800',
            '激进投资': 'bg-red-100 text-red-800',
            '科技投资': 'bg-purple-100 text-purple-800'
        };
        
        // 持仓变动类型颜色映射
        const positionColorMap = {
            increase: 'bg-green-100 text-green-800',
            decrease: 'bg-red-100 text-red-800',
            unchanged: 'bg-gray-100 text-gray-800'
        };
        
        Object.keys(investorData).forEach(investorId => {
            const investor = investorData[investorId];
            const avatarUrl = avatarMap[investorId] || avatarMap['warren_buffett'];
            const styleColor = styleColorMap[investor.investmentStyle] || 'bg-gray-100 text-gray-800';
            
            let positionsHtml = '';
            investor.positions.forEach(pos => {
                const posColor = positionColorMap[pos.type] || 'bg-gray-100 text-gray-800';
                positionsHtml += `
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-700">${pos.stock}</span>
                        <span class="position-badge ${posColor}">${pos.change}</span>
                    </div>
                `;
            });
            
            container.innerHTML += `
            <div class="investor-card card-hover bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden" data-category="${investorId.includes('warren') || investorId.includes('buffett') ? 'value' : 'macro'}">
                <div class="p-4 flex flex-col space-y-3">
                    <div class="flex items-start space-x-4">
                        <img src="${avatarUrl}" alt="${investor.name}" class="w-16 h-16 rounded-full object-cover border-2 border-primary">
                        <div class="flex-1">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-lg">${investor.name}</h3>
                                <span class="text-xs font-medium ${styleColor} px-2 py-1 rounded-full">${investor.investmentStyle}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">${investor.title}</p>
                        </div>
                    </div>
                    
                    <!-- 最新持仓信息 -->
                    <div class="mt-2">
                        <p class="text-sm font-medium text-gray-800 mb-1 flex items-center">
                            <i class="fa fa-bar-chart mr-1 text-primary"></i>最新持仓变动
                        </p>
                        <div class="space-y-1.5">
                            ${positionsHtml}
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-2 flex justify-between items-center">
                    <div class="flex space-x-2">
                        <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">${investor.bio}</span>
                    </div>
                    <button class="text-primary hover:text-secondary text-sm font-medium investor-detail-btn" data-id="${investorId}">
                        查看详情 <i class="fa fa-angle-right ml-1"></i>
                    </button>
                </div>
            </div>
            `;
        });
    }

    // ====================== 工具函数 ======================
    /**
     * 获取备份的财经事件数据（离线备用）
     */
    function getBackupFinancialEvents() {
        return [
            {
                id: 1,
                title: '美联储宣布降息25个基点',
                summary: '美联储在最新的货币政策会议上宣布降息25个基点，这是自2019年以来的首次降息。',
                source: '华尔街日报',
                publishTime: '2025-02-18T03:45:00',
                aiTools: ['doubao', 'qianwen', 'yuanbao', 'gemini'],
                importance: {doubao:5,qianwen:4,yuanbao:5,gemini:4},
                relatedInvestors: ['warren_buffett','ray_dalio'],
                relatedQuotes: {
                    warren_buffett: '降息对股市是利好，但应关注企业基本面。',
                    ray_dalio: '全球央行政策转向宽松，应调整资产配置。'
                },
                industry: 'finance',
                sentiment: 'positive',
                detailUrl: 'https://www.wsj.com/finance/fed-rate-cut-2025'
            }
        ];
    }

    /**
     * 获取备份的投资大佬数据（离线备用）
     */
    function getBackupInvestors() {
        return {
            warren_buffett: {
                name:"沃伦·巴菲特",
                title:"伯克希尔·哈撒韦CEO",
                bio:"价值投资大师",
                investmentStyle:"价值投资",
                positions: [
                    {stock: "苹果 (AAPL)", change: "增持 5.2%", type: "increase"},
                    {stock: "美国银行 (BAC)", change: "减持 3.8%", type: "decrease"},
                    {stock: "可口可乐 (KO)", change: "持仓不变", type: "unchanged"},
                    {stock: "雪佛龙 (CVX)", change: "增持 8.5%", type: "increase"}
                ]
            }
        };
    }

    /**
     * 更新最后刷新时间显示
     */
    function updateLastUpdateTime() {
        const now = new Date();
        const formattedTime = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        document.getElementById('last-update-time').textContent = formattedTime;
    }

    /**
     * 计算距离每日刷新时间的毫秒数
     */
    function getTimeToNextRefresh(hours, minutes) {
        const now = new Date();
        const nextRefresh = new Date();
        nextRefresh.setHours(hours, minutes, 0, 0);
        
        // 如果今天的刷新时间已过，设置为明天
        if (nextRefresh <= now) {
            nextRefresh.setDate(nextRefresh.getDate() + 1);
        }
        
        return nextRefresh - now;
    }

    /**
     * 防抖函数
     */
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    // ====================== 筛选功能 ======================
    function setupFilters(){
        const aiToolFilter = document.getElementById('ai-tool-filter');
        const investmentStyleFilter = document.getElementById('investment-style-filter');
        const timeFilter = document.getElementById('time-filter');
        const industryFilter = document.getElementById('industry-filter');
        const searchBtn = document.getElementById('search-btn');
        
        function filterAll(){
            let filtered = [...financialEvents];
            const ai = aiToolFilter.value;
            const ind = industryFilter.value;
            
            if(ai!='all') filtered = filtered.filter(e=>e.aiTools.includes(ai));
            if(ind!='all') filtered = filtered.filter(e=>e.industry===ind);
            
            renderFinancialEvents(filtered);
        }
        
        searchBtn.onclick = filterAll;
        aiToolFilter.onchange = filterAll;
        industryFilter.onchange = filterAll;
        timeFilter.onchange = filterAll;
        investmentStyleFilter.onchange = filterAll;
    }

    // ====================== 初始化和自动刷新 ======================
    /**
     * 初始化页面
     */
    async function initPage() {
        // 1. 首次加载数据
        await Promise.all([
            fetchFinancialEventsFromDoubao(),
            fetchInvestorsFromDoubao()
        ]);
        
        // 2. 渲染初始数据
        renderFinancialEvents(financialEvents);
        renderInvestors(investors);
        
        // 3. 设置筛选功能
        setupFilters();
        
        // 4. 设置手动刷新按钮
        const debouncedRefresh = debounce(async () => {
            const newEvents = await fetchFinancialEventsFromDoubao();
            const newInvestors = await fetchInvestorsFromDoubao();
            renderFinancialEvents(newEvents);
            renderInvestors(newInvestors);
        }, config.debounceTime);
        
        document.getElementById('refresh-btn').addEventListener('click', debouncedRefresh);
        document.getElementById('news-refresh-btn').addEventListener('click', async () => {
            const newEvents = await fetchFinancialEventsFromDoubao();
            renderFinancialEvents(newEvents);
        });
        document.getElementById('investor-refresh-btn').addEventListener('click', async () => {
            const newInvestors = await fetchInvestorsFromDoubao();
            renderInvestors(newInvestors);
        });
        
        // 5. 设置每日自动刷新
        const [hours, minutes] = config.refreshTime.split(':').map(Number);
        const setupDailyRefresh = () => {
            const timeToRefresh = getTimeToNextRefresh(hours, minutes);
            
            // 设置定时器
            setTimeout(async () => {
                console.log('执行每日自动刷新...');
                await debouncedRefresh();
                
                // 刷新完成后，继续设置下一天的定时器
                setupDailyRefresh();
            }, timeToRefresh);
            
            console.log(`下次自动刷新将在 ${new Date(Date.now() + timeToRefresh).toLocaleString()} 执行`);
        };
        
        // 启动每日自动刷新
        setupDailyRefresh();
    }

    // 页面加载完成后初始化
    window.onload = initPage;
</script>
</body>
</html>
