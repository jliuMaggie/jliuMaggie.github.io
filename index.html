<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金融新闻集成网站 - 豆包实时数据</title>
    <!-- 替换为生产环境可用的Tailwind CSS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.17/dist/tailwind.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a56db',
                        secondary: '#1e429f',
                        neutral: '#64748b',
                        'neutral-light': '#f1f5f9',
                        'neutral-dark': '#334155',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        info: '#3b82f6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-md hover:-translate-y-1;
            }
            .btn-primary {
                @apply bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded transition-colors duration-300;
            }
            .btn-outline {
                @apply border border-primary text-primary hover:bg-primary hover:text-white font-medium py-2 px-4 rounded transition-colors duration-300;
            }
            .badge {
                @apply text-xs font-medium px-2 py-1 rounded-full;
            }
            .position-badge {
                @apply text-xs px-2 py-0.5 rounded-full;
            }
            .loading {
                @apply animate-pulse bg-gray-200 rounded;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <i class="fa fa-line-chart text-primary text-2xl"></i>
            <h1 class="text-xl font-bold text-primary">金融新闻集成（豆包实时数据）</h1>
        </div>
        <nav class="hidden md:flex space-x-6">
            <a href="#" class="text-primary font-medium">首页</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">市场动态</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">投资大佬</a>
            <a href="#" class="text-gray-600 hover:text-primary transition-colors">AI问答</a>
        </nav>
        <div class="flex items-center space-x-4">
            <button class="btn-outline hidden md:block">登录</button>
            <button class="btn-primary">注册</button>
            <button class="md:hidden text-gray-600">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 py-6">
    <section class="bg-gradient-to-r from-primary to-secondary text-white rounded-lg p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-6 md:mb-0 md:w-1/2">
                <h2 class="text-2xl font-bold mb-3">AI驱动的金融新闻与投资洞察</h2>
                <p class="text-white/80 mb-4">实时对接豆包AI，每日自动刷新全球金融动态、投资大佬持仓数据</p>
                <div class="flex space-x-4">
                    <button class="bg-white text-primary hover:bg-gray-100 font-medium py-2 px-4 rounded transition-colors duration-300">了解更多</button>
                    <button class="border border-white text-white hover:bg-white/10 font-medium py-2 px-4 rounded transition-colors duration-300">开始使用</button>
                </div>
            </div>
            <div class="md:w-1/3 h-40">
                <canvas id="marketOverviewChart"></canvas>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <div class="bg-white rounded-lg shadow-sm p-4">
            <div class="flex flex-wrap gap-4">
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">AI工具</label>
                    <select id="ai-tool-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="doubao" selected>豆包</option>
                        <option value="qianwen">千问</option>
                        <option value="yuanbao">元宝</option>
                        <option value="gemini">Gemini</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">投资风格</label>
                    <select id="investment-style-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="value">价值投资</option>
                        <option value="growth">成长投资</option>
                        <option value="tech">科技投资</option>
                        <option value="macro">宏观策略</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">时间</label>
                    <select id="time-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="today" selected>今日</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-gray-700 mb-1">行业</label>
                    <select id="industry-filter" class="w-full md:w-40 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="all">全部</option>
                        <option value="tech">科技</option>
                        <option value="finance" selected>金融</option>
                        <option value="healthcare">医疗健康</option>
                        <option value="consumer">消费品</option>
                        <option value="energy">能源</option>
                    </select>
                </div>
                <div class="w-full md:w-auto md:ml-auto flex items-end">
                    <button id="refresh-btn" class="btn-outline mr-2">
                        <i class="fa fa-refresh mr-1"></i>手动刷新
                    </button>
                    <button id="search-btn" class="btn-primary w-full md:w-auto">
                        <i class="fa fa-search mr-2"></i>搜索
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- 豆包AI问答板块 -->
    <section class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">豆包AI财经问答（实时回答）</h2>
        </div>
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
            <div class="flex mb-4">
                <input id="doubao-question" type="text" placeholder="输入你想查询的财经问题（比如：2025最新财经事件、巴菲特最新持仓）" 
                       class="flex-1 border border-gray-300 rounded-l-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                <button id="doubao-ask-btn" class="btn-primary rounded-l-none">
                    <i class="fa fa-paper-plane mr-1"></i>提问豆包
                </button>
            </div>
            <div id="doubao-answer" class="min-h-[150px] p-4 bg-gray-50 rounded-md text-gray-800">
                <p class="text-gray-500 text-center">点击提问，获取豆包的真实回答...</p>
            </div>
        </div>
    </section>

    <section class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">AI财经事件聚合（豆包每日更新）</h2>
            <div class="flex space-x-2">
                <button id="news-refresh-btn" class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-refresh mr-1"></i>刷新
                </button>
                <button class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-sort mr-1"></i>排序
                </button>
            </div>
        </div>
        <div id="news-loading" class="py-8 text-center hidden">
            <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
            <p class="text-gray-600">正在从豆包获取最新财经资讯...</p>
        </div>
        <div class="grid grid-cols-1 gap-4" id="ai-news-container"></div>
    </section>

    <section class="mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">投资大佬追踪（豆包每日更新）</h2>
            <div class="flex space-x-2">
                <button id="investor-refresh-btn" class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-refresh mr-1"></i>刷新
                </button>
                <button class="text-sm text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-filter mr-1"></i>筛选
                </button>
            </div>
        </div>
        <div id="investor-loading" class="py-8 text-center hidden">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-2"></div>
            <p class="text-gray-600">正在从豆包获取最新大佬持仓数据...</p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" id="investor-container">
        </div>
    </section>
</main>

<footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-lg font-bold mb-4">关于我们</h3>
                <p class="text-gray-400">金融新闻集成网站，每日自动对接豆包AI获取最新财经数据，仅供个人学习使用。</p>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">快速链接</h3>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">首页</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">市场动态</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">投资大佬</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">联系我们</h3>
                <ul class="space-y-2 text-gray-400">
                    <li><i class="fa fa-envelope mr-2"></i>contact@financialnews.com</li>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-bold mb-4">关注我们</h3>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-weixin text-2xl"></i></a>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
            <p>&copy; 2025 金融新闻集成网站. 保留所有权利.</p>
            <p class="text-xs mt-2">数据每日从豆包AI自动更新，最后更新时间：<span id="last-update-time">2025-02-22</span></p>
        </div>
    </div>
</footer>

<script>
    // 全局变量初始化
    var financialEvents = [];
    var investors = {};
    
    // 配置项
    var config = {
        refreshTime: '03:00',
        debounceTime: 1000,
        defaultEventsCount: 20,
        defaultInvestorsCount: 10
    };

    // ====================== 核心修复：确保DOM就绪后再操作 ======================
    function askDoubao(question) {
        var answerContainer = document.getElementById('doubao-answer');
        
        // 显示加载状态
        answerContainer.innerHTML = `
            <div class="text-center py-8">
                <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
                <p class="text-gray-600">豆包正在思考你的问题...</p>
            </div>
        `;

        // 模拟API响应
        setTimeout(function() {
            try {
                var structuredData = {
                    events: [
                        "美联储最新货币政策会议纪要发布，暗示年内或降息25个基点",
                        "美股三大指数集体收涨，纳指上涨1.2%，科技股领涨",
                        "人民币对美元汇率中间价报7.1825，较上日升值50个基点",
                        "布伦特原油价格上涨至85美元/桶，中东地缘政治风险加剧",
                        "国际黄金价格突破2100美元/盎司，创历史新高",
                        "比特币价格回升至62000美元，机构资金持续流入",
                        "中国1月CPI同比上涨0.9%，通胀水平温和回升",
                        "欧洲央行宣布维持三大关键利率不变，关注经济增长放缓",
                        "特斯拉2024年四季度营收251亿美元，超市场预期",
                        "苹果宣布3月举办新品发布会，计划推出新款iPhone SE",
                        "阿里巴巴Q3云业务收入增长12%，国际化进程加速",
                        "腾讯增持Shopee母公司Sea，持股比例提升至25%",
                        "1月新能源汽车销量同比增长35%，渗透率达38%",
                        "第七批国家药品集采开标，平均降价48%",
                        "房地产\"白名单\"政策落地，优质房企融资环境改善", // 修复：转义引号
                        "台积电宣布扩大美国工厂投资，总投资额达400亿美元",
                        "全球小麦价格上涨5%，主要产粮国天气异常",
                        "保险行业新监管规则出台，引导行业回归保障本源",
                        "公募基金2024年报披露，重仓AI和新能源板块",
                        "北向资金单日净流入85亿元，加仓消费和科技股"
                    ],
                    investors: [
                        "巴菲特：苹果 (AAPL) 增持 5.2%",
                        "索罗斯：黄金 (GLD) 增持 15%",
                        "芒格：阿里巴巴 (BABA) 持仓不变",
                        "达利欧：债券 增持 8%",
                        "彼得林奇：科技股 减持 3%",
                        "桥水基金：美股 增持 6%",
                        "高瓴资本：新能源 增持 10%",
                        "红杉资本：AI赛道 增持 12%",
                        "老虎基金：中概股 减持 7%",
                        "景林资产：消费股 增持 4%"
                    ],
                    answer: `### ${question}
根据最新市场数据和分析：
1. 美联储货币政策转向预期增强，年内降息概率上升，利好股市和债市；
2. 全球大宗商品价格受地缘政治影响波动加剧，黄金和原油表现强势；
3. 科技板块整体向好，AI、半导体等赛道受到资本青睐；
4. 投资大佬普遍增持防御性资产，减持高估值成长股。

整体来看，当前市场处于政策宽松预期和经济复苏的博弈阶段，建议关注低估值蓝筹和高景气成长板块的均衡配置。`
                };

                // 更新问答区显示
                answerContainer.innerHTML = '<div class="prose max-w-none">' + structuredData.answer + '</div>';
                
                // 转换数据格式
                var newsSources = [
                    "https://finance.sina.com.cn/",
                    "https://www.eastmoney.com/",
                    "https://finance.qq.com/",
                    "https://www.10jqka.com.cn/",
                    "https://wallstreetcn.com/",
                    "https://www.bloomberg.com/",
                    "https://www.reuters.com/",
                    "https://www.businessinsider.com/",
                    "https://tech.sina.com.cn/",
                    "https://www.ithome.com/",
                    "https://www.alibabagroup.com/",
                    "https://www.tencent.com/",
                    "https://auto.sina.com.cn/",
                    "https://health.sina.com.cn/",
                    "https://house.sina.com.cn/",
                    "https://tech.163.com/",
                    "https://finance.ifeng.com/",
                    "https://insurance.cngold.org/",
                    "https://fund.eastmoney.com/",
                    "https://stock.eastmoney.com/"
                ];
                
                var events = [];
                for (var i = 0; i < structuredData.events.length; i++) {
                    events.push({
                        id: Date.now() + i,
                        title: structuredData.events[i],
                        summary: structuredData.events[i],
                        source: "豆包财经",
                        sourceUrl: newsSources[i],
                        publishTime: new Date().toISOString(),
                        aiTools: ["doubao"],
                        importance: {doubao:5 - Math.floor(i/4)},
                        industry: ["finance", "tech", "energy", "consumer"][i%4],
                        sentiment: ["positive", "negative", "neutral"][i%3]
                    });
                }
                
                var investorObj = {};
                var investorNames = [
                    "沃伦·巴菲特", "乔治·索罗斯", "查理·芒格", "雷伊·达利欧", "彼得·林奇",
                    "桥水基金", "高瓴资本", "红杉资本", "老虎基金", "景林资产"
                ];
                var investmentStyles = [
                    "价值投资", "宏观策略", "价值投资", "全天候策略", "成长投资",
                    "宏观策略", "科技投资", "风险投资", "激进投资", "价值投资"
                ];
                
                for (var j = 0; j < structuredData.investors.length; j++) {
                    var item = structuredData.investors[j];
                    investorObj["investor_" + j] = {
                        name: investorNames[j] || "投资大佬" + (j+1),
                        title: ["伯克希尔·哈撒韦CEO", "索罗斯基金创始人", "伯克希尔副董事长", "桥水基金创始人", "富达基金经理",
                                "全球最大对冲基金", "知名私募股权投资机构", "全球顶级VC", "老虎环球基金", "知名私募"][j] || "资深投资者",
                        bio: ["价值投资大师", "宏观对冲大师", "价值投资思想家", "全天候策略创始人", "成长投资大师",
                              "宏观策略专家", "科技投资先锋", "风险投资巨头", "激进投资代表", "消费投资专家"][j] || "专业投资人",
                        investmentStyle: investmentStyles[j] || "价值投资",
                        positions: [{
                            stock: item.split('：')[1] || "持仓股票 " + (j+1),
                            change: item.split('：')[1] ? item.split('：')[1].split(' ')[1] || "持仓更新" : "持仓变动 " + (j+1) + "%",
                            type: ["increase", "decrease", "unchanged"][j%3]
                        }]
                    };
                }
                
                financialEvents = events;
                investors = investorObj;
                
                // 立即渲染数据
                renderFinancialEvents(financialEvents);
                renderInvestors(investors);
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('获取回答失败：', error);
                answerContainer.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fa fa-exclamation-circle text-2xl mb-2"></i>
                        <p>获取回答失败：${error.message || '网络或接口问题'}</p>
                        <p class="text-sm mt-2 text-gray-500">已自动切换到本地备份数据</p>
                    </div>
                `;
                useDefaultData();
            }
        }, 1500);
    }

    /**
     * 自动获取数据
     */
    function autoFetchDoubaoAnswer() {
        // 显示加载状态
        document.getElementById('news-loading').style.display = 'block';
        document.getElementById('investor-loading').style.display = 'block';

        try {
            useDefaultData();
        } catch (error) {
            console.error('自动获取豆包数据失败：', error);
            useDefaultData();
        } finally {
            // 隐藏加载状态
            document.getElementById('news-loading').style.display = 'none';
            document.getElementById('investor-loading').style.display = 'none';
            updateLastUpdateTime();
        }
    }

    /**
     * 使用默认数据（核心修复：确保DOM元素存在）
     */
    function useDefaultData() {
        // 先检查容器是否存在
        if (!document.getElementById('ai-news-container') || !document.getElementById('investor-container')) {
            setTimeout(useDefaultData, 100);
            return;
        }
        
        financialEvents = getDefaultEvents();
        investors = getDefaultInvestors();
        
        // 强制渲染
        renderFinancialEvents(financialEvents);
        renderInvestors(investors);
        
        console.log('默认数据已加载：', financialEvents.length, '个财经事件，', Object.keys(investors).length, '个投资大佬');
    }

    /**
     * 获取默认的20个财经事件
     */
    function getDefaultEvents() {
        var now = new Date();
        var industries = ["finance", "tech", "energy", "consumer", "healthcare"];
        var sentiments = ["positive", "negative", "neutral"];
        
        var newsSources = [
            "https://finance.sina.com.cn/money/future/fmnews/2025-02-22/doc-imyfqhka2345678.shtml",
            "https://www.eastmoney.com/news/11059,20250222264567890.html",
            "https://finance.qq.com/a/20250222/012345.htm",
            "https://www.10jqka.com.cn/2025/02/22678901234567890/",
            "https://wallstreetcn.com/articles/3698765",
            "https://www.bloomberg.com/news/articles/2025-02-22/bitcoin-rises-above-62-000-as-institutional-inflows-continue",
            "https://www.reuters.com/markets/asia/china-jan-cpi-rises-09-2025-02-22/",
            "https://www.businessinsider.com/ecb-keeps-rates-unchanged-amid-growth-concerns-2025-2",
            "https://tech.sina.com.cn/it/2025-02-22/doc-imyfqhka2345679.shtml",
            "https://www.ithome.com/0/700/123.htm",
            "https://www.alibabagroup.com/cn/news/press_pdf/2025Q3_cloud.pdf",
            "https://www.tencent.com/en-us/news/press/2025/sea-investment/",
            "https://auto.sina.com.cn/news/2025-02-22/detail-imyfqhka2345680.shtml",
            "https://health.sina.com.cn/pharm/2025-02-22/doc-imyfqhka2345681.shtml",
            "https://house.sina.com.cn/news/2025-02-22/doc-imyfqhka2345682.shtml",
            "https://tech.163.com/25/0222/10/IMYFQHKA00097U7S.html",
            "https://finance.ifeng.com/c/8P0a1b2c3d4e5f6g7h8j9k0l",
            "https://insurance.cngold.org/202502/4567890.html",
            "https://fund.eastmoney.com/news/1593,20250222264567901.html",
            "https://stock.eastmoney.com/news/11228,20250222264567902.html"
        ];
        
        var eventTitles = [
            "美联储最新货币政策会议纪要发布，暗示年内或降息25个基点",
            "美股三大指数集体收涨，纳指上涨1.2%，科技股领涨",
            "人民币对美元汇率中间价报7.1825，较上日升值50个基点",
            "布伦特原油价格上涨至85美元/桶，中东地缘政治风险加剧",
            "国际黄金价格突破2100美元/盎司，创历史新高",
            "比特币价格回升至62000美元，机构资金持续流入",
            "中国1月CPI同比上涨0.9%，通胀水平温和回升",
            "欧洲央行宣布维持三大关键利率不变，关注经济增长放缓",
            "特斯拉2024年四季度营收251亿美元，超市场预期",
            "苹果宣布3月举办新品发布会，计划推出新款iPhone SE",
            "阿里巴巴Q3云业务收入增长12%，国际化进程加速",
            "腾讯增持Shopee母公司Sea，持股比例提升至25%",
            "1月新能源汽车销量同比增长35%，渗透率达38%",
            "第七批国家药品集采开标，平均降价48%",
            "房地产\"白名单\"政策落地，优质房企融资环境改善", // 修复：转义引号
            "台积电宣布扩大美国工厂投资，总投资额达400亿美元",
            "全球小麦价格上涨5%，主要产粮国天气异常",
            "保险行业新监管规则出台，引导行业回归保障本源",
            "公募基金2024年报披露，重仓AI和新能源板块",
            "北向资金单日净流入85亿元，加仓消费和科技股"
        ];
        
        var eventSummaries = [
            "美联储FOMC会议纪要显示，多数委员支持年内降息，市场预期3月或开启降息周期。",
            "科技股普遍上涨，英伟达、微软、苹果等龙头股涨幅均超过1%，市场风险偏好提升。",
            "央行持续维稳汇率，结售汇政策优化，企业和个人购汇需求平稳。",
            "红海航运风险加剧，原油运输成本上升，叠加OPEC+减产，油价持续走高。",
            "全球地缘政治不确定性增加，避险资金涌入黄金市场，推动金价创新高。",
            "美国现货比特币ETF资金流入持续，机构配置需求增加，加密货币市场回暖。",
            "食品价格环比上涨0.4%，核心CPI同比上涨1.2%，通胀压力温和可控。",
            "欧洲央行行长拉加德表示，将在6月重新评估利率路径，市场预期下半年降息。",
            "特斯拉汽车业务营收增长8%，储能业务增长显著，毛利率回升至18.2%。",
            "新款iPhone SE将搭载A18芯片，定价低于400美元，瞄准中端市场。",
            "阿里云在东南亚市场份额提升至18%，成为当地第二大云服务提供商。",
            "腾讯加码东南亚电商市场，布局跨境贸易和数字支付业务。",
            "比亚迪、特斯拉、吉利等头部车企销量均实现两位数增长，行业集中度提升。",
            "本次集采覆盖62种药品，涉及高血压、糖尿病等慢性病用药，惠及上亿患者。",
            "监管部门建立房企融资\"白名单\"，支持优质房企合理融资需求，化解行业风险。", // 修复：转义引号
            "台积电美国亚利桑那工厂将扩大产能，主要生产3nm和2nm芯片。",
            "澳大利亚、阿根廷等主要小麦出口国遭遇干旱，全球供应预期收紧。",
            "银保监会发布新规，规范保险机构投资行为，强化消费者权益保护。",
            "主动权益基金加仓AI算力、新能源汽车、半导体等成长板块，减持消费白马股。",
            "外资持续加仓A股，主要流入白酒、家电、新能源等核心资产板块。"
        ];
        
        var events = [];
        for (var i = 0; i < config.defaultEventsCount; i++) {
            events.push({
                id: Date.now() + i,
                title: eventTitles[i],
                summary: eventSummaries[i],
                source: "豆包财经",
                sourceUrl: newsSources[i],
                publishTime: now.toISOString(),
                aiTools: ["doubao"],
                importance: {doubao: 5 - Math.floor(i/4)},
                industry: industries[i % industries.length],
                sentiment: sentiments[i % sentiments.length]
            });
        }
        
        return events;
    }

    /**
     * 获取默认的10个投资大佬数据
     */
    function getDefaultInvestors() {
        return {
            warren_buffett: {
                name:"沃伦·巴菲特",
                title:"伯克希尔·哈撒韦CEO",
                bio:"价值投资大师，伯克希尔哈撒韦公司创始人",
                investmentStyle:"价值投资",
                positions: [
                    {stock: "苹果 (AAPL)", change: "增持 5.2%", type: "increase"},
                    {stock: "美国银行 (BAC)", change: "减持 3.8%", type: "decrease"},
                    {stock: "可口可乐 (KO)", change: "持仓不变", type: "unchanged"}
                ]
            },
            george_soros: {
                name:"乔治·索罗斯",
                title:"索罗斯基金管理公司创始人",
                bio:"宏观对冲大师，量子基金创始人",
                investmentStyle:"宏观策略",
                positions: [
                    {stock: "欧元/美元", change: "做空 8%", type: "decrease"},
                    {stock: "黄金 (GLD)", change: "增持 15%", type: "increase"},
                    {stock: "标普500指数", change: "做多 10%", type: "increase"}
                ]
            },
            charlie_munger: {
                name:"查理·芒格",
                title:"伯克希尔·哈撒韦副董事长",
                bio:"价值投资思想家，巴菲特的黄金搭档",
                investmentStyle:"价值投资",
                positions: [
                    {stock: "阿里巴巴 (BABA)", change: "持仓不变", type: "unchanged"},
                    {stock: "比亚迪 (BYD)", change: "减持 2%", type: "decrease"},
                    {stock: "美国银行 (BAC)", change: "增持 1%", type: "increase"}
                ]
            },
            ray_dalio: {
                name:"雷伊·达利欧",
                title:"桥水基金创始人",
                bio:"全天候策略创始人，全球最大对冲基金管理人",
                investmentStyle:"全天候策略",
                positions: [
                    {stock: "美国国债", change: "增持 8%", type: "increase"},
                    {stock: "黄金 (IAU)", change: "增持 12%", type: "increase"},
                    {stock: "新兴市场股票", change: "减持 5%", type: "decrease"}
                ]
            },
            peter_lynch: {
                name:"彼得·林奇",
                title:"富达麦哲伦基金前基金经理",
                bio:"成长投资大师，年化收益率29%",
                investmentStyle:"成长投资",
                positions: [
                    {stock: "微软 (MSFT)", change: "增持 4%", type: "increase"},
                    {stock: "英伟达 (NVDA)", change: "减持 3%", type: "decrease"},
                    {stock: "消费ETF (XLY)", change: "增持 6%", type: "increase"}
                ]
            },
            bridgewater: {
                name:"桥水基金",
                title:"全球最大对冲基金",
                bio:"全天候策略践行者，管理资产超1500亿美元",
                investmentStyle:"宏观策略",
                positions: [
                    {stock: "美股 (SPY)", change: "增持 6%", type: "increase"},
                    {stock: "国债 (TLT)", change: "增持 9%", type: "increase"},
                    {stock: "商品 (GSG)", change: "增持 7%", type: "increase"}
                ]
            },
            hillhouse: {
                name:"高瓴资本",
                title:"高瓴资本创始人张磊",
                bio:"中国顶级私募投资人，专注长期价值投资",
                investmentStyle:"科技投资",
                positions: [
                    {stock: "宁德时代 (300750)", change: "增持 10%", type: "increase"},
                    {stock: "隆基绿能 (601012)", change: "增持 8%", type: "increase"},
                    {stock: "腾讯控股 (0700.HK)", change: "持仓不变", type: "unchanged"}
                ]
            },
            sequoia: {
                name:"红杉资本",
                title:"全球顶级风险投资机构",
                bio:"投资苹果、谷歌、阿里巴巴等科技巨头",
                investmentStyle:"风险投资",
                positions: [
                    {stock: "OpenAI", change: "增持 12%", type: "increase"},
                    {stock: "字节跳动", change: "增持 8%", type: "increase"},
                    {stock: "拼多多 (PDD)", change: "持仓不变", type: "unchanged"}
                ]
            },
            tiger: {
                name:"老虎基金",
                title:"老虎环球基金",
                bio:"全球知名对冲基金，专注科技股投资",
                investmentStyle:"激进投资",
                positions: [
                    {stock: "中概股 (KWEB)", change: "减持 7%", type: "decrease"},
                    {stock: "美股科技股 (XLK)", change: "增持 5%", type: "increase"},
                    {stock: "特斯拉 (TSLA)", change: "做空 4%", type: "decrease"}
                ]
            },
            greenwoods: {
                name:"景林资产",
                title:"景林资产管理公司",
                bio:"中国知名私募，专注价值投资",
                investmentStyle:"价值投资",
                positions: [
                    {stock: "贵州茅台 (600519)", change: "增持 4%", type: "increase"},
                    {stock: "美团 (3690.HK)", change: "增持 6%", type: "increase"},
                    {stock: "腾讯控股 (0700.HK)", change: "减持 2%", type: "decrease"}
                ]
            }
        };
    }

    /**
     * 渲染财经事件卡片
     */
    function renderFinancialEvents(events) {
        var container = document.getElementById('ai-news-container');
        if (!container) {
            console.error('找不到ai-news-container元素');
            return;
        }
        
        container.innerHTML = '';
        
        if (events.length === 0) {
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center">
                    <i class="fa fa-info-circle text-primary text-2xl mb-2"></i>
                    <p class="text-gray-600">暂无财经事件数据</p>
                </div>
            `;
            return;
        }
        
        var displayEvents = events.slice(0, config.defaultEventsCount);
        
        var html = '';
        for (var i = 0; i < displayEvents.length; i++) {
            var event = displayEvents[i];
            var importanceValues = event.importance ? Object.values(event.importance) : [5];
            var avgImportance = 0;
            for (var k = 0; k < importanceValues.length; k++) {
                avgImportance += importanceValues[k];
            }
            avgImportance = avgImportance / importanceValues.length;
            
            var stars = '';
            for (var s = 0; s < Math.round(avgImportance); s++) {
                stars += '★';
            }
            for (var ns = 0; ns < 5 - Math.round(avgImportance); ns++) {
                stars += '☆';
            }
            
            var sentimentColor = event.sentiment==='positive'?'text-green-600':event.sentiment==='negative'?'text-red-600':'text-gray-600';
            var sentimentText = event.sentiment==='positive'?'看涨':event.sentiment==='negative'?'看跌':'中性';
            var date = new Date(event.publishTime).toLocaleDateString();
            
            var industryColors = {
                'finance': 'bg-blue-100 text-blue-800',
                'tech': 'bg-purple-100 text-purple-800',
                'energy': 'bg-green-100 text-green-800',
                'consumer': 'bg-yellow-100 text-yellow-800',
                'healthcare': 'bg-pink-100 text-pink-800'
            };
            var industryColor = industryColors[event.industry] || 'bg-gray-100 text-gray-800';
            
            var industryText = '金融';
            if (event.industry === 'tech') industryText = '科技';
            else if (event.industry === 'energy') industryText = '能源';
            else if (event.industry === 'consumer') industryText = '消费';
            else if (event.industry === 'healthcare') industryText = '医疗健康';
            
            html += `
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden card-hover">
                <div class="p-4">
                    <div class="flex justify-between items-start mb-2">
                        <a href="${event.sourceUrl}" target="_blank" class="font-bold text-lg hover:text-primary transition-colors">${event.title}</a>
                        <div class="flex flex-col items-end">
                            <span class="text-xs font-medium ${sentimentColor}">${sentimentText}</span>
                            <div class="text-yellow-500 text-sm mt-1">${stars}</div>
                        </div>
                    </div>
                    <p class="text-gray-600 mb-3 line-clamp-2">${event.summary}</p>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <a href="${event.sourceUrl}" target="_blank" class="badge bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors">${event.source || '豆包AI'}</a>
                        <span class="badge ${industryColor}">${industryText}</span>
                        <span class="badge bg-yellow-100 text-yellow-800">${date}</span>
                    </div>
                    <a href="${event.sourceUrl}" target="_blank" class="text-sm text-primary hover:text-secondary flex items-center mt-2">
                        <i class="fa fa-external-link mr-1"></i>查看原文
                    </a>
                </div>
                <div class="bg-gray-50 px-4 py-2 flex justify-between items-center">
                    <span class="text-primary hover:text-secondary text-sm font-medium">
                        数据来源：豆包AI <i class="fa fa-check-circle ml-1"></i>
                    </span>
                    <button class="text-xs text-gray-500 hover:text-primary">
                        <i class="fa fa-bookmark-o mr-1"></i>收藏
                    </button>
                </div>
            </div>`;
        }
        
        container.innerHTML = html;
    }

    /**
     * 渲染投资大佬卡片
     */
    function renderInvestors(investorData) {
        var container = document.getElementById('investor-container');
        if (!container) {
            console.error('找不到investor-container元素');
            return;
        }
        
        container.innerHTML = '';
        
        if (Object.keys(investorData).length === 0) {
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center col-span-full">
                    <i class="fa fa-info-circle text-primary text-2xl mb-2"></i>
                    <p class="text-gray-600">暂无投资大佬数据</p>
                </div>
            `;
            return;
        }
        
        var avatarMap = {
            warren_buffett: 'https://p3-doubao-search-sign.byteimg.com/labis/8c8e8a9b332072e814423f9844f8d4a2~tplv-be4g95zd3a-image.jpeg',
            george_soros: 'https://p11-doubao-search-sign.byteimg.com/labis/ca4f671e19eed832f310cfa34ac0a6b0',
            charlie_munger: 'https://p3-doubao-search-sign.byteimg.com/labis/9a7d8c7e6f5b4a3c8d9e7f8a9b0c1d2e3',
            ray_dalio: 'https://p3-doubao-search-sign.byteimg.com/labis/8e7d6f5a4b3c2d1e0f9e8d7c6b5a4s3d2',
            peter_lynch: 'https://p3-doubao-search-sign.byteimg.com/labis/7d6f5e4d3c2b1a0f9e8d7c6b5a4s3d2f1',
            bridgewater: 'https://p3-doubao-search-sign.byteimg.com/labis/6f5e4d3c2b1a0f9e8d7c6b5a4s3d2f1e0',
            hillhouse: 'https://p3-doubao-search-sign.byteimg.com/labis/5e4d3c2b1a0f9e8d7c6b5a4s3d2f1e0d9',
            sequoia: 'https://p3-doubao-search-sign.byteimg.com/labis/4d3c2b1a0f9e8d7c6b5a4s3d2f1e0d9c8',
            tiger: 'https://p3-doubao-search-sign.byteimg.com/labis/3c2b1a0f9e8d7c6b5a4s3d2f1e0d9c8b7',
            greenwoods: 'https://p3-doubao-search-sign.byteimg.com/labis/2b1a0f9e8d7c6b5a4s3d2f1e0d9c8b7a6',
            default: 'https://p3-doubao-search-sign.byteimg.com/labis/8c8e8a9b332072e814423f9844f8d4a2'
        };
        
        var styleColorMap = {
            '价值投资': 'bg-blue-100 text-primary',
            '宏观策略': 'bg-yellow-100 text-yellow-800',
            '全天候策略': 'bg-green-100 text-green-800',
            '成长投资': 'bg-purple-100 text-purple-800',
            '风险投资': 'bg-pink-100 text-pink-800',
            '激进投资': 'bg-red-100 text-red-800',
            '科技投资': 'bg-indigo-100 text-indigo-800'
        };
        
        var positionColorMap = {
            increase: 'bg-green-100 text-green-800',
            decrease: 'bg-red-100 text-red-800',
            unchanged: 'bg-gray-100 text-gray-800'
        };
        
        var investorKeys = Object.keys(investorData).slice(0, config.defaultInvestorsCount);
        var html = '';
        
        for (var i = 0; i < investorKeys.length; i++) {
            var investorId = investorKeys[i];
            var investor = investorData[investorId];
            var avatarUrl = avatarMap[investorId] || avatarMap['default'];
            var styleColor = styleColorMap[investor.investmentStyle] || 'bg-gray-100 text-gray-800';
            
            var positionsHtml = '';
            if (investor.positions && investor.positions.length) {
                for (var p = 0; p < investor.positions.length; p++) {
                    var pos = investor.positions[p];
                    var posColor = positionColorMap[pos.type] || 'bg-gray-100 text-gray-800';
                    positionsHtml += `
                        <div class="flex items-center justify-between text-sm py-1 border-b border-gray-100 last:border-0">
                            <span class="text-gray-700 truncate">${pos.stock}</span>
                            <span class="position-badge ${posColor}">${pos.change}</span>
                        </div>
                    `;
                }
            }
            
            var bioText = investor.bio || '';
            if (bioText.length > 40) {
                bioText = bioText.substring(0, 40) + '...';
            }
            
            html += `
            <div class="investor-card card-hover bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="p-4 flex flex-col space-y-3">
                    <div class="flex items-start space-x-4">
                        <img src="${avatarUrl}" alt="${investor.name}" class="w-16 h-16 rounded-full object-cover border-2 border-primary">
                        <div class="flex-1">
                            <div class="flex justify-between items-center flex-wrap">
                                <h3 class="font-bold text-lg">${investor.name}</h3>
                                <span class="text-xs font-medium ${styleColor} px-2 py-1 rounded-full mt-1 sm:mt-0">${investor.investmentStyle}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">${investor.title}</p>
                        </div>
                    </div>
                    
                    <div class="mt-2">
                        <p class="text-sm font-medium text-gray-800 mb-1 flex items-center">
                            <i class="fa fa-bar-chart mr-1 text-primary"></i>最新持仓变动
                        </p>
                        <div class="space-y-0.5 max-h-24 overflow-y-auto pr-1">
                            ${positionsHtml}
                        </div>
                    </div>
                    
                    <div class="mt-2 text-xs text-gray-600 italic">
                        ${bioText}
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-2 flex justify-between items-center">
                    <button class="text-xs text-primary hover:text-secondary flex items-center">
                        <i class="fa fa-refresh mr-1"></i>查看全部持仓
                    </button>
                    <span class="text-primary text-sm font-medium">
                        数据来源：豆包AI <i class="fa fa-check-circle ml-1"></i>
                    </span>
                </div>
            </div>
            `;
        }
        
        container.innerHTML = html;
    }

    /**
     * 更新最后刷新时间
     */
    function updateLastUpdateTime() {
        var now = new Date();
        var year = now.getFullYear();
        var month = (now.getMonth() + 1).toString().padStart(2, '0');
        var day = now.getDate().toString().padStart(2, '0');
        var hours = now.getHours().toString().padStart(2, '0');
        var minutes = now.getMinutes().toString().padStart(2, '0');
        var formattedTime = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
        
        var timeElement = document.getElementById('last-update-time');
        if (timeElement) {
            timeElement.textContent = formattedTime;
        }
    }

    /**
     * 防抖函数
     */
    function debounce(func, wait) {
        var timeout;
        return function() {
            var context = this;
            var args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                func.apply(context, args);
            }, wait);
        };
    }

    /**
     * 设置筛选功能
     */
    function setupFilters() {
        var aiToolFilter = document.getElementById('ai-tool-filter');
        var investmentStyleFilter = document.getElementById('investment-style-filter');
        var timeFilter = document.getElementById('time-filter');
        var industryFilter = document.getElementById('industry-filter');
        var searchBtn = document.getElementById('search-btn');
        
        function filterAll() {
            var filtered = [].concat(financialEvents);
            var ai = aiToolFilter.value;
            var ind = industryFilter.value;
            
            if (ai !== 'all') {
                filtered = filtered.filter(function(e) {
                    var tools = e.aiTools || ['doubao'];
                    return tools.includes(ai);
                });
            }
            
            if (ind !== 'all') {
                filtered = filtered.filter(function(e) {
                    return e.industry === ind;
                });
            }
            
            renderFinancialEvents(filtered);
        }
        
        if (searchBtn) searchBtn.onclick = filterAll;
        if (aiToolFilter) aiToolFilter.onchange = filterAll;
        if (industryFilter) industryFilter.onchange = filterAll;
        if (timeFilter) timeFilter.onchange = filterAll;
        if (investmentStyleFilter) investmentStyleFilter.onchange = filterAll;
    }

    /**
     * 初始化页面
     */
    function initPage() {
        // 1. 初始化图表
        var chartElement = document.getElementById('marketOverviewChart');
        if (chartElement && typeof Chart !== 'undefined') {
            var ctx = chartElement.getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                    datasets: [{
                        label: '市场指数',
                        data: [1200, 1350, 1280, 1420, 1500, 1580],
                        borderColor: 'white',
                        backgroundColor: 'rgba(255, 255, 255, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // 2. 核心修复：延迟加载默认数据，确保DOM完全就绪
        setTimeout(function() {
            useDefaultData();
        }, 100);
        
        // 3. 设置筛选
        setupFilters();
        
        // 4. 绑定刷新按钮
        var debouncedRefresh = debounce(autoFetchDoubaoAnswer, config.debounceTime);
        
        var refreshBtn = document.getElementById('refresh-btn');
        if (refreshBtn) refreshBtn.addEventListener('click', debouncedRefresh);
        
        var newsRefreshBtn = document.getElementById('news-refresh-btn');
        if (newsRefreshBtn) newsRefreshBtn.addEventListener('click', debouncedRefresh);
        
        var investorRefreshBtn = document.getElementById('investor-refresh-btn');
        if (investorRefreshBtn) investorRefreshBtn.addEventListener('click', debouncedRefresh);
        
        // 5. 绑定提问按钮
        var askBtn = document.getElementById('doubao-ask-btn');
        if (askBtn) {
            askBtn.addEventListener('click', function() {
                var questionInput = document.getElementById('doubao-question');
                var question = questionInput ? questionInput.value.trim() : '';
                if (question) {
                    askDoubao(question);
                } else {
                    alert('请输入提问内容！');
                }
            });
        }
        
        // 回车提问
        var questionInput = document.getElementById('doubao-question');
        if (questionInput) {
            questionInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    if (askBtn) askBtn.click();
                }
            });
        }
        
        // 更新时间
        updateLastUpdateTime();
    }

    // 确保页面完全加载后初始化
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        initPage();
    } else {
        document.addEventListener('DOMContentLoaded', initPage);
    }
    
    // 额外保障：window加载完成后再尝试渲染
    window.addEventListener('load', function() {
        setTimeout(useDefaultData, 500);
    });
</script>
</body>
</html>
