<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时财经科技观察站 v2.0</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio" data-turbo-track="reload"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#6B7280',
                        success: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .news-item:hover {
                transform: translateY(-2px);
                transition: all 0.2s ease;
            }
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-inter">
    <!-- 顶部导航 -->
    <header class="bg-white sticky top-0 z-50 card-shadow">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-2xl font-bold text-primary flex items-center mb-3 md:mb-0">
                <i class="fas fa-line-chart mr-2"></i>
                实时财经科技观察站
            </h1>
            <div class="flex items-center space-x-4">
                <span id="last-update" class="text-sm text-gray-500">
                    最后更新：--
                </span>
                <button id="refresh-all" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center">
                    <i class="fas fa-sync-alt mr-2"></i>
                    刷新全部
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 1. 财经科技事件板块 -->
        <section class="mb-12">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-newspaper mr-2 text-primary"></i>
                    近24小时重要财经科技事件（Top20）
                </h2>
                <button id="refresh-news" class="text-primary hover:text-primary/80 flex items-center text-sm">
                    <i class="fas fa-refresh mr-1"></i>
                    刷新事件
                </button>
            </div>
            <div id="news-loading" class="text-center py-10">
                <i class="fas fa-spinner fa-spin text-primary text-2xl mb-2"></i>
                <p class="text-gray-500">正在获取最新财经事件...</p>
            </div>
            <div id="news-container" class="space-y-3 hidden">
                <!-- 新闻列表将通过JS渲染 -->
            </div>
            <div id="news-error" class="text-center py-10 text-red-500 hidden">
                <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                <p>加载财经事件失败，请稍后重试</p>
            </div>
        </section>

        <!-- 2. 投资大佬持仓板块 -->
        <section class="mb-12">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-user-tie mr-2 text-primary"></i>
                    投资大佬近期持仓变动
                </h2>
                <button id="refresh-investors" class="text-primary hover:text-primary/80 flex items-center text-sm">
                    <i class="fas fa-refresh mr-1"></i>
                    刷新持仓
                </button>
            </div>
            <div id="investors-loading" class="text-center py-10">
                <i class="fas fa-spinner fa-spin text-primary text-2xl mb-2"></i>
                <p class="text-gray-500">正在获取大佬持仓信息...</p>
            </div>
            <div id="investors-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 hidden">
                <!-- 大佬持仓将通过JS渲染 -->
            </div>
            <div id="investors-error" class="text-center py-10 text-red-500 hidden">
                <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                <p>加载持仓信息失败，请稍后重试</p>
            </div>
        </section>

        <!-- 3. AI投资分析提问板块 -->
        <section>
            <h2 class="text-xl font-bold text-gray-800 flex items-center mb-4">
                <i class="fas fa-comments mr-2 text-primary"></i>
                AI投资分析提问
            </h2>
            <div class="bg-white rounded-lg p-5 card-shadow">
                <div class="mb-4">
                    <textarea id="question-input" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入你想分析的投资问题，例如：分析近期AI芯片行业的投资机会和风险"></textarea>
                </div>
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        豆包AI将基于实时信息为你分析投资机会和风险
                    </p>
                    <button id="submit-question" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center">
                        <i class="fas fa-paper-plane mr-2"></i>
                        提交提问
                    </button>
                </div>
            </div>

            <div id="answer-container" class="mt-5 hidden">
                <div class="bg-white rounded-lg p-5 card-shadow">
                    <h3 class="font-semibold text-gray-800 mb-3">AI分析回答：</h3>
                    <div id="answer-loading" class="text-center py-5">
                        <i class="fas fa-spinner fa-spin text-primary text-xl mb-2"></i>
                        <p class="text-gray-500">豆包正在分析中...</p>
                    </div>
                    <div id="answer-content" class="prose max-w-none hidden">
                        <!-- AI回答将通过JS渲染 -->
                    </div>
                    <div id="answer-error" class="text-red-500 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>
                        获取回答失败，请稍后重试
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>实时财经科技观察站 v2.0 | 数据来源：豆包AI实时联网搜索</p>
            <p class="text-sm text-gray-400 mt-2">© 2025 财经观察站 | 豆包API提供支持</p>
        </div>
    </footer>

    <script>
        // 全局配置
        const API_BASE_URL = 'https://doubao-api-proxy.jliu0721.workers.dev';
        let newsRefreshTimer = null;

        // 工具函数：格式化时间
        function formatTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // 工具函数：显示加载状态
        function showLoading(containerId, loadingId, errorId) {
            document.getElementById(containerId).classList.add('hidden');
            document.getElementById(loadingId).classList.remove('hidden');
            document.getElementById(errorId).classList.add('hidden');
        }

        // 工具函数：显示错误状态
        function showError(errorId, message) {
            document.getElementById(errorId).classList.remove('hidden');
            if (message) {
                document.getElementById(errorId).querySelector('p').textContent = message;
            }
        }

        // 1. 获取财经新闻事件
        async function fetchNews() {
            showLoading('news-container', 'news-loading', 'news-error');
            
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: 'news' })
                });

                const result = await response.json();
                if (result.success) {
                    const newsList = result.data;
                    const container = document.getElementById('news-container');
                    
                    // 渲染新闻列表
                    container.innerHTML = newsList.map((news, index) => `
                        <div class="news-item bg-white p-4 rounded-lg card-shadow">
                            <div class="flex items-start">
                                <span class="text-primary font-bold text-lg mr-3">${index + 1}</span>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800 mb-2">${news.title}</h3>
                                    <p class="text-gray-600 text-sm mb-2">${news.summary}</p>
                                    <div class="flex justify-between items-center text-xs text-gray-500">
                                        <span class="px-2 py-1 bg-${news.domain === '科技' ? 'blue' : news.domain === '互联网' ? 'purple' : 'green'}/10 text-${news.domain === '科技' ? 'blue' : news.domain === '互联网' ? 'purple' : 'green'}-600 rounded">${news.domain}</span>
                                        <a href="${news.link}" target="_blank" class="text-primary hover:underline">查看原文 <i class="fas fa-external-link-alt ml-1"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    // 更新时间
                    document.getElementById('last-update').textContent = `最后更新：${formatTime(result.updateTime)}`;
                    
                    container.classList.remove('hidden');
                } else {
                    showError('news-error', result.error);
                }
            } catch (error) {
                console.error('获取新闻失败:', error);
                showError('news-error', '加载财经事件失败，请稍后重试');
            } finally {
                document.getElementById('news-loading').classList.add('hidden');
            }
        }

        // 2. 获取投资大佬持仓
        async function fetchInvestors() {
            showLoading('investors-container', 'investors-loading', 'investors-error');
            
            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: 'investors' })
                });

                const result = await response.json();
                if (result.success) {
                    const investorList = result.data;
                    const container = document.getElementById('investors-container');
                    
                    // 渲染大佬持仓
                    container.innerHTML = investorList.map(item => `
                        <div class="bg-white p-4 rounded-lg card-shadow">
                            <h3 class="font-bold text-lg text-gray-800 mb-2">${item.name}</h3>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600"><span class="text-gray-500">标的：</span>${item.stock}</p>
                                <p class="text-sm text-gray-600">
                                    <span class="text-gray-500">变动：</span>
                                    <span class="${item.direction.includes('增持') ? 'text-green-600' : item.direction.includes('减持') ? 'text-red-600' : 'text-blue-600'}">
                                        ${item.direction} ${item.change}
                                    </span>
                                </p>
                                <a href="${item.link}" target="_blank" class="text-primary text-sm hover:underline">查看来源 <i class="fas fa-external-link-alt ml-1"></i></a>
                            </div>
                        </div>
                    `).join('');
                    
                    container.classList.remove('hidden');
                } else {
                    showError('investors-error', result.error);
                }
            } catch (error) {
                console.error('获取持仓失败:', error);
                showError('investors-error', '加载持仓信息失败，请稍后重试');
            } finally {
                document.getElementById('investors-loading').classList.add('hidden');
            }
        }

        // 3. 提交AI提问
        async function submitQuestion() {
            const question = document.getElementById('question-input').value.trim();
            if (!question) {
                alert('请输入提问内容');
                return;
            }

            const answerContainer = document.getElementById('answer-container');
            const answerLoading = document.getElementById('answer-loading');
            const answerContent = document.getElementById('answer-content');
            const answerError = document.getElementById('answer-error');

            // 显示加载状态
            answerContainer.classList.remove('hidden');
            answerLoading.classList.remove('hidden');
            answerContent.classList.add('hidden');
            answerError.classList.add('hidden');

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: 'ask', question: question })
                });

                const result = await response.json();
                if (result.success) {
                    answerContent.innerHTML = `<div class="prose max-w-none">${result.answer}</div>`;
                    answerContent.classList.remove('hidden');
                } else {
                    answerError.classList.remove('hidden');
                    answerError.querySelector('p').textContent = result.error;
                }
            } catch (error) {
                console.error('提问失败:', error);
                answerError.classList.remove('hidden');
            } finally {
                answerLoading.classList.add('hidden');
            }
        }

        // 4. 初始化页面
        async function initPage() {
            // 同时加载新闻和大佬持仓
            await Promise.all([fetchNews(), fetchInvestors()]);
            
            // 设置12小时自动刷新新闻
            newsRefreshTimer = setInterval(() => {
                fetchNews();
            }, 12 * 60 * 60 * 1000); // 12小时
        }

        // 绑定事件监听
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化页面
            initPage();

            // 刷新全部
            document.getElementById('refresh-all').addEventListener('click', () => {
                Promise.all([fetchNews(), fetchInvestors()]);
            });

            // 刷新新闻
            document.getElementById('refresh-news').addEventListener('click', fetchNews);

            // 刷新持仓
            document.getElementById('refresh-investors').addEventListener('click', fetchInvestors);

            // 提交提问
            document.getElementById('submit-question').addEventListener('click', submitQuestion);

            // 回车提交提问
            document.getElementById('question-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitQuestion();
                }
            });
        });
    </script>
</body>
</html>
